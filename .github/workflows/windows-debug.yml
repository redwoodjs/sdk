name: Windows Debug Session

on:
  workflow_dispatch:

jobs:
  debug-session:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Prepare for Interactive Debugging
        shell: pwsh
        run: |
          # 1. Download the VS Code CLI
          $CliUri = "https://code.visualstudio.com/sha/download?build=stable&os=cli-win32-x64"
          $CliZip = "$env:TEMP\\vscode-cli.zip"
          Invoke-WebRequest -Uri $CliUri -OutFile $CliZip

          # 2. Extract it
          $CliPath = "$env:TEMP\\vscode-cli"
          Expand-Archive -Path $CliZip -DestinationPath $CliPath -Force

          # 3. Add the CLI to the PATH for the next step
          echo $CliPath | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

      - name: Start Interactive Debug Session
        uses: mxschmitt/action-tmate@v3
        # The previous attempt, for reference in the interactive session:
        #
        # - name: Setup VS Code Remote Tunnel
        #   env:
        #     VSCODE_TUNNEL_PAT: ${{ secrets.VSCODE_TUNNEL_TOKEN }}
        #   shell: pwsh
        #   run: |
        #     # Authenticate with the PAT from the environment variable
        #     & "C:\\Users\\runneradmin\\AppData\\Local\\Temp\\vscode-cli\\code.exe" tunnel user login --provider github --access-token $env:VSCODE_TUNNEL_PAT
        #
        #     # Run the tunnel command.
        #     & "C:\\Users\\runneradmin\\AppData\\Local\\Temp\\vscode-cli\\code.exe" tunnel --accept-server-license-terms --name "rwsdk-windows-debug-${{ github.run_id }}"
